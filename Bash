#!/bin/bash
# Get Terraform output value (e.g., network_id) from the Terraform state
NETWORK_ID=$(terraform output -raw network_id)
SUBNET_ID=$(terraform output -raw subnet_id)

# Print the values to confirm
echo "Network ID: $NETWORK_ID"
echo "Subnet ID: $SUBNET_ID"

# Run Packer build using the environment variables
packer build \
  -var "project_id=${PROJECT_ID}" \
  -var "image_name=${IMAGE_NAME}" \
  -var "image_family=${IMAGE_FAMILY}" \
  -var "ssh_user=${SSH_USER}" \
  -var "architecture=${ARCHITECTURE}" \
  -var "root_volume=${ROOT_VOLUME}" \
  -var "device_type=${DEVICE_TYPE}" \
  -var "source_image_family=${SOURCE_IMAGE_FAMILY}" \
  -var "source_image_project=${SOURCE_IMAGE_PROJECT}" \
  -var "network_id=${NETWORK_ID}" \
  -var "subnet_id=${SUBNET_ID}" \
  ./packer-template.pkr.hcl


output "network_id" {
  description = "The ID of the network"
  value       = google_compute_network.vpc1.id
}

output "subnet_id" {
  description = "The ID of the subnet"
  value       = google_compute_subnetwork.subnetwork1.id
}

output "project_id" {
  description = "The ID of the project"
  value       = var.project_id
}
