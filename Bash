# Get the image name with the label 'latest'
IMAGE_NAME=$(gcloud compute images list \
    --filter="labels.latest=true" \
    --format="value(NAME)")

# Grant access to the service account
if [[ -n "$IMAGE_NAME" ]]; then
    gcloud compute images add-iam-policy-binding "$IMAGE_NAME" \
        --member="serviceAccount:SERVICE_ACCOUNT_EMAIL" \
        --role="roles/compute.imageUser"
    echo "Access granted to the service account for image: $IMAGE_NAME"
else
    echo "No image found with the label 'latest'."
fi
